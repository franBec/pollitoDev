---
author: "Franco Becvort"
title: "VPS 5: Implementaci√≥n de una aplicaci√≥n full-stack"
date: 2025-02-03
description: "Votando por el Pok√©mon m√°s redondo"
categories: ["VPS"]
thumbnail: /uploads/2025-02-03-vps-5/DALL¬∑E2025-02-0314.50.40.jpg
---

<!-- TOC -->
  * [Qu√© es &ldquo;Roundest Pok√©mon&rdquo;?](#qu√©-es-roundest-pok√©mon)
  * [¬øQu√© vamos a necesitar?](#qu√©-vamos-a-necesitar)
  * [Agregar recurso PostgreSQL](#agregar-recurso-postgresql)
  * [pgAdmin](#pgadmin)
    * [Agregar el recurso Docker](#agregar-el-recurso-docker)
    * [Agregar un nuevo servidor](#agregar-un-nuevo-servidor)
    * [Rellenar datos iniciales](#rellenar-datos-iniciales)
    * [Crear un usuario espec√≠fico para su aplicaci√≥n](#crear-un-usuario-espec√≠fico-para-su-aplicaci√≥n)
  * [Crear una aplicaci√≥n de GitHub en Coolify](#crear-una-aplicaci√≥n-de-github-en-coolify)
    * [¬øPor qu√©?](#por-qu√©)
    * [¬øC√≥mo?](#c√≥mo)
  * [Despliegue mediante GitHub App](#despliegue-mediante-github-app)
    * [Spring Boot](#spring-boot)
    * [Next.js](#nextjs)
  * [Uso de recursos del VPS](#uso-de-recursos-del-vps)
    * [Descripci√≥n general del sistema](#descripci√≥n-general-del-sistema)
    * [Actividad de contenedores y procesos](#actividad-de-contenedores-y-procesos)
    * [Alertas cr√≠ticas](#alertas-cr√≠ticas)
  * [Una conclusi√≥n sentimental para el blog de VPS](#una-conclusi√≥n-sentimental-para-el-blog-de-vps)
<!-- TOC -->

Esta es la quinta y √∫ltima parte de mi [VPS blog series](/es/categories/vps/).

## Qu√© es &ldquo;Roundest Pok√©mon&rdquo;?

"Roundest Pok√©mon" es un ejercicio de programaci√≥n com√∫n que consiste en un juego de votaci√≥n interactivo para decidir qu√© Pok√©mon es el m√°s redondo.

Vamos a a√±adirle una novedad: la posibilidad de elegir qu√© sistema de backend procesa la votaci√≥n.

![backend-selector](/uploads/2025-02-03-vps-5/backend-selector.gif)

Esta caracter√≠stica nos ayudar√° a ilustrar c√≥mo se pueden implementar diferentes sistemas y trabajar juntos sin problemas, todos implementados en el VPS bajo un proyecto Coolify.

![vote-flow](/uploads/2025-02-03-vps-5/vote-flow.gif)

## ¬øQu√© vamos a necesitar?

- Una base de datos (voy a usar [Postgres](https://www.postgresql.org/))
  - Un administrador de base de datos: no es crucial para la aplicaci√≥n en s√≠, pero es necesario para crear y editar esquemas si no quieres [confiar en la funci√≥n DDL Auto de Hibernate](https://stackoverflow.com/questions/221379/hibernate-hbm2ddl-auto-update-in-production). Voy a usar [pgAdmin](https://www.pgadmin.org/).
- La [aplicaci√≥n frontend](https://github.com/franBec/roundest_nextjs) (yo us√© Next.js).
- Las diferentes aplicaciones backend:
  - [Java](https://github.com/franBec/roundest_java), lenguaje con el que estoy trabajando actualmente, me siento como pez en el agua aqu√≠.
  - [Kotlin](https://github.com/franBec/roundest_kotlin), ten√≠a curiosidad por probarlo, pero me decepcion√≥ un poco.
  - [Groovy](https://github.com/franBec/roundest_groovy), mi primer amor, y todav√≠a me encanta.

Todas las aplicaciones fueron escritas por m√≠. En el futuro, publicar√© art√≠culos sobre ellas.

## Agregar recurso PostgreSQL

1. Crea un nuevo proyecto:
   - Haz clic en **Projects** en el men√∫ de la izquierda.
   - Haz clic en **Add a new project**.
   - N√≥mbralo "roundest_pokemon".
   - Haz clic en **Create**. Deber√≠as tener un proyecto "roundest_pokemon" creado.
     ![coolify-projects](/uploads/2025-02-03-vps-5/coolify-projects.png)
2. Agrega un nuevo recurso PostgreSQL:
   - Ve a tu proyecto **"roundest_pokemon"**.
   - Haz clic en **+ New**.
   - En **Databases**, selecciona **Postgres**.
     ![projects-postgres.png](/uploads/2025-02-03-vps-5/projects-postgres.png)
   - Selecciona la opci√≥n predeterminada, ya que aqu√≠ solo necesitamos una base de datos SQL simple.
     ![postgres-16](/uploads/2025-02-03-vps-5/postgres-16.png)
   - Deje todo como est√° predeterminado y haga clic en **Start**.
     ![postgres-start](/uploads/2025-02-03-vps-5/postgres-start.png)

**¬øC√≥mo podemos gestionar la base de datos?**

- **Exponer la base de datos al Internet:** una opci√≥n totalmente v√°lida, pero que implicar√≠a:
  - Cambiar las configuraciones del firewall para exponer un nuevo puerto.
  - Estar en riesgo de sufrir ataques de fuerza bruta.
- **Utilizar una interfaz web para gestionar la base de datos sin exponerla p√∫blicamente:** mantiene la base de datos privada a la vez que permite ejecutar consultas dentro de la red interna.

Optemos por el segundo enfoque.

## pgAdmin
### Agregar el recurso Docker

1. Ve al proyecto "roundest_pokemon".
   - **Es muy importante que est√© dentro del mismo proyecto**, de lo contrario, pgAdmin no podr√° acceder a la base de datos ya creada.
2. Haz clic en **+ New**.
3. En **Docker Based**, seleccione **Docker Image**.
4. Se solicitar√° que indique un nombre de imagen. Escribe `dpage/pgadmin4` y haga clic en **Guardar**.
5. As√≠gnele un dominio (como `https://pgadmin4.yourdomain.com`) y haz clic en **Guardar**.
   ![docker-image-pgadmin4](/uploads/2025-02-03-vps-5/docker-image-pgadmin4.png)
6. En **Enviroment Variables**, agregue las credenciales que se usar√°n para iniciar sesi√≥n en pgAdmin:
   - `PGADMIN_DEFAULT_EMAIL`
   - `PGADMIN_DEFAULT_PASSWORD` (caracteres alfanum√©ricos, no s√≠mbolos)

   ![pgadmin-credentials.png](/uploads/2025-02-03-vps-5/pgadmin-credentials.png)

### Agregar un nuevo servidor

1. Ve a `pgadmin4.yourdomain.com` e inicia sesi√≥n con las credenciales que ingresaste en las variables de entorno de `dpage/pgadmin4`.
2. Una vez dentro, ve a **Add new server**.

    ![pgadmin4.png](/uploads/2025-02-03-vps-5/pgadmin4.png)
3. En **General**, puedes darle el nombre que quieras
4. En **Connection**, debes completar:
   - **Host name/address:** el nombre del host de la URL interna de PostgreSQL (est√° entre `@` y `:5432`).
   - **Port:** por defecto es `5432`.
   - **Username:** el nombre de usuario de PostgreSQL.

    ![postgres-conf.png](/uploads/2025-02-03-vps-5/postgres-conf.png)
    ![pgadmin-connection.png](/uploads/2025-02-03-vps-5/pgadmin-connection.png)
5. Al guardar, se te pedir√° la contrase√±a.

Ahora puedes ejecutar consultas a la base de datos, manteni√©ndola segura dentro de la red interna.

### Rellenar datos iniciales

1. En la barra lateral izquierda, en **Servers** -> _el servidor que acabas de agregar_ -> **Databases** -> **Schemas**, haz clic derecho y seleccione **Query Tool**. Se abrir√° una consola de consulta.

    ![pgadmin-query-tool.png](/uploads/2025-02-03-vps-5/pgadmin-query-tool.png)

2. Pega y ejecuta [este script sql](https://github.com/franBec/roundest_java/blob/main/src/main/resources/data.sql) que crea una tabla para los Pok√©mon + inserta Pok√©mon de primera generaci√≥n, con 0 votos iniciales.
3. Recupere los datos creados para comprobar que todo est√© bien.

```sql
SELECT * FROM pokemons;
```
![pgadmin-select-pokemon.png](/uploads/2025-02-03-vps-5/pgadmin-select-pokemon.png)

### Crear un usuario espec√≠fico para su aplicaci√≥n

Crear un usuario espec√≠fico para su aplicaci√≥n (en lugar de usar el superusuario de postgres predeterminado u otras cuentas de administrador) es una pr√°ctica recomendada de seguridad y operativa.

Creemos un usuario con acceso limitado al esquema p√∫blico:

```sql
-- Create backend_app_user
CREATE USER backend_app_user WITH PASSWORD 'your_secure_password_here';

-- Grant Basic Connection Permissions
GRANT CONNECT ON DATABASE postgres TO backend_app_user;

-- Grant Schema Permissions
GRANT USAGE ON SCHEMA public TO backend_app_user;

-- Grant Table Permissions: For existing tables
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO backend_app_user;

-- Grant Table Permissions: For future tables (default privileges)
ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO backend_app_user;

-- Grant Sequence Permissions: For existing sequences
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO backend_app_user;

-- Grant Sequence Permissions: For future sequences
ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT USAGE, SELECT ON SEQUENCES TO backend_app_user;
```

## Crear una aplicaci√≥n de GitHub en Coolify

### ¬øPor qu√©?

- Para implementar repositorios privados.
- Para habilitar despliegues autom√°ticas a trav√©s de webhooks.

### ¬øC√≥mo?

1. **Accede a las fuentes en Coolify:**
   - Navega hasta **Sources** en tu panel de Coolify.
   - Haz clic en **Add** para crear una nueva aplicaci√≥n de GitHub.
2. **Configura la aplicaci√≥n de GitHub:**
   - Proporciona un **nombre √∫nico** para tu aplicaci√≥n de GitHub (por ejemplo, `coolify-pollito-tech`). El nombre es √∫nico a nivel global en GitHub.
   - Establece el **Webhook Endpoint** a la **HTTPS URL** de tu instancia de Coolify (el HTTP puede causar problemas de entrega del webhook).
   - Haz clic en **Register Now** para continuar en GitHub.
   
      ![github-app-register.png](/uploads/2025-02-03-vps-5/github-app-register.png)
3. **Configurar el acceso al repositorio en GitHub:**
   - Siga el principio de "privilegio m√≠nimo", otorgue acceso solo a los repositorios que planea implementar.
   - Haz clic en **Install** para finalizar la configuraci√≥n de la aplicaci√≥n de GitHub.
4. **Verificar los permisos en Coolify:**
   - Regresa a Coolify y haz clic en **Refetch** para confirmar que la aplicaci√≥n de GitHub tiene los permisos correctos.
   - Una configuraci√≥n exitosa mostrar√° que la aplicaci√≥n tiene acceso a los repositorios seleccionados.

      ![github-app-save.png](/uploads/2025-02-03-vps-5/github-app-save.png)

Para agregar nuevos repositorios m√°s tarde, haz clic en **Update Repositories**. Esto lo redireccionar√° a GitHub, donde puede actualizar el acceso al repositorio.

## Despliegue mediante GitHub App

### Spring Boot

Implementemos una de las aplicaciones backend.

1. Dir√≠gete a tu proyecto "roundest_pokemon".
   - **Es muy importante que est√©s dentro del mismo proyecto**, de lo contrario, la aplicaci√≥n no podr√° acceder a la base de datos ya creada.
2. Haz clic en **+ New**.
3. En **Git Based**, selecciona **Repositorio privado (con aplicaci√≥n de GitHub)**.
    ![resource-github-app.png](/uploads/2025-02-03-vps-5/resource-github-app.png)
4. Elige el repositorio que contiene la aplicaci√≥n.
   - Puedes dejar todo lo dem√°s como predeterminado, ya que lo configuras en el siguiente paso.
5. **Configurar los ajustes de la aplicaci√≥n:**
   - **Application Type**: este repositorio cuenta con un [Dockerfile](https://docs.docker.com/build/concepts/dockerfile/) que yo personalmente he probado un poco y hasta ahora parece funcionar bien. As√≠ que selecciona **Dockerfile**.
   - Agrega tu **custom domain** (por ejemplo, `app.your-domain.com`)
     ![roundest-groovy-conf1.png](/uploads/2025-02-03-vps-5/roundest-groovy-conf1.png)
   - Si te desplazas un poco hacia abajo, encontrar√°s la secci√≥n **Network**. Para estas aplicaciones de backend, en **Ports exposes**, establece `8080`. El puerto puede variar entre diferentes tipos de aplicaciones.
     ![roundest-groovy-conf2.png](/uploads/2025-02-03-vps-5/roundest-groovy-conf2.png)
   - En **Environment Variables**, agregue todas las que necesite la aplicaci√≥n. En esta aplicaci√≥n en particular, necesito el host de la base de datos, el puerto, la base de datos, el nombre de usuario y la contrase√±a. Recuerde utilizar el usuario y la contrase√±a de la base de datos espec√≠fica que creamos anteriormente.
6. **Deploy**: Coolify har√° lo siguiente:
   - Clonar√° el repositorio.
   - Construir√° la imagen de Docker usando el archivo Dockerfile.
   - Desplegar√° el contenedor con las variables de entorno y dominio configurado.

Visite "https://app.your-domain.com" para confirmar que la aplicaci√≥n est√© activa.

![roundest-groovy-live.png](/uploads/2025-02-03-vps-5/roundest-groovy-live.png)

Baile y repita para todas las aplicaciones Spring Boot similares.

### Next.js

El proceso de implementaci√≥n de las aplicaciones Next.js es casi id√©ntico al backend de Spring Boot, con un cambio de configuraci√≥n clave:

1. Vaya a su proyecto (por ejemplo, "roundest_pokemon").
   - **Se aplica requisito de estar en el mismo proyecto**, esto garantiza que el frontend pueda comunicarse con los servicios del backend.
2. Haga clic en **+ New** -> **Private Repository (with GitHub App)**.
3. Seleccione su repositorio Next.js.
4. **Configurar los ajustes de la aplicaci√≥n:**
   - **Application Type**: seleccione [Nixpacks](https://nixpacks.com/docs). Detecta autom√°ticamente Next.js y maneja las optimizaciones de compilaci√≥n.
   - Agregue su **dominio frontend** (por ejemplo, `vote.your-domain.com`).
     ![roundest-nextjs-conf1.png](/uploads/2025-02-03-vps-5/roundest-nextjs-conf1.png)
   - En la secci√≥n **Network**: Establezca el puerto expuesto en `3000` (puerto predeterminado de Next.js).
     ![roundest-nextjs-conf2.png](/uploads/2025-02-03-vps-5/roundest-nextjs-conf2.png)
   - Agregue cualquier **Environment Variable** requerida.
5. **Deploy**.

Puedes interactuar con mi resultado final [aqu√≠](https://roundest-pokemon.pollito.tech/). No prometo mantenerlo disponible para siempre, ya que puedo usar este VPS para otros proyectos que puedan necesitar la totalidad del poder computacional.

## Uso de recursos del VPS

Esta captura de pantalla captura el VPS **ejecut√°ndose inactivo** y muestra varias m√©tricas de recursos.

![stats.png](/uploads/2025-02-03-vps-5/stats.png)

Recordemos que este VPS est√° ejecutando:
- Una aplicaci√≥n Next.js.
- Una aplicaci√≥n Java.
- Una aplicaci√≥n Kotlin.
- Una aplicaci√≥n Groovy.
- Una base de datos (Postgres).
- Un gestor de bases de datos (pgadmin).
- Glances (monitorizaci√≥n).
- Coolify, el panel de administraci√≥n desde donde gestionamos las aplicaciones.

### Descripci√≥n general del sistema
- **CPU**: el sistema utiliza aproximadamente el **8,1 % de la CPU**, y la mayor parte del uso proviene de procesos en segundo plano.
- **Memoria**: el **34,3 % de la RAM** est√° en uso, con algo de swap space asignado pero no utilizado activamente.
- **Promedio de carga**: la carga del sistema sigue siendo baja, con un promedio de 15 minutos de **0,26**, lo que indica una actividad m√≠nima.
- **E/S de disco**: no se producen operaciones de lectura/escritura significativas, lo que significa que no hay un uso intensivo del disco.
- **Red**: actividad m√≠nima de la red, con solo unos pocos kilobytes de datos transferidos.

### Actividad de contenedores y procesos
- Hay varios **contenedores Docker** en ejecuci√≥n, pero la mayor√≠a est√°n inactivos.
- Los **procesos que m√°s consumen CPU** incluyen:
  - `python3` ejecutando `glances` para monitoreo.
  - `dockerd` administrando contenedores.
  - Servicios en segundo plano como `redis-server` y `php-fpm`, necesarios para Coolify
  - Procesos `java` (los sistemas backend).

### Alertas cr√≠ticas
El sistema ha registrado **alertas de alto uso de CPU** en el pasado debido a `java`, `python3` y `dockerd`. Esto ocurri√≥ durante la implementaci√≥n de los servicios de backend.

## Una conclusi√≥n sentimental para el blog de VPS

Esta se ha convertido en mi serie de blog favorita de todas las que he escrito.

Quiero tomarme un momento para reflexionar sobre lo lejos que hemos llegado juntos. Cuando preguntamos por primera vez: "¬øQu√© es un VPS?"

- En la **Parte 1**, reconocimos el atractivo de la tecnolog√≠a sin servidor y, al mismo tiempo, abrazamos el valor de tener el control de tu propio servidor. No necesitas construir el pr√≥ximo Facebook para merecer una infraestructura que sea confiable, flexible y tuya.
- En la **Parte 2**, nos pusimos manos a la obra y construimos una base: elegimos un proveedor, reforzamos la seguridad y sentamos las bases para todo lo que vendr√≠a despu√©s. No fue glamoroso, pero, como plantar un √°rbol, ech√≥ ra√≠ces para el crecimiento.
- Luego vino la **Parte 3**, donde Coolify entr√≥ en escena, transformando nuestro VPS de un lienzo en blanco a un poderoso conjunto de herramientas. Con proxies, HTTPS y firewalls, convertimos la complejidad en simplicidad, demostrando que la administraci√≥n de servidores moderna puede ser s√≥lida y accesible.
- La **Parte 4** le dio vida a nuestro servidor con Glances, un panel de control en tiempo real protegido por Caddy.
- Finalmente, en la **Parte 5**, implementamos una aplicaci√≥n completa con una base de datos.

Esta serie trata sobre el placer de crear un espacio que es completamente tuyo, libre de los caprichos de los precios opacos de la nube y soluciones m√°gicas. Se trata de la **confianza silenciosa**: saber que, incluso si tu aplicaci√≥n sigue siendo peque√±a, se ejecutar√° sin problemas, de forma segura y en tus t√©rminos.

A medida que avanza, recuerde que **todo experto fue alguna vez un principiante que utiliz√≥ SSH por primera vez**. El servidor es un compa√±ero, no un cr√≠tico. Experimenta, rompe cosas (¬°y luego arr√©glelas!) y celebra los logros, ya sea que se trate de aplicar una regla de firewall o implementar esa primera aplicaci√≥n.

Si has seguido este tutorial, ahora no solo tienes un VPS, sino tambi√©n el conocimiento para adaptarlo a lo que tus proyectos requieran. Sigue experimentando, aprendiendo y, lo m√°s importante, sigue creando cosas que te importen.

![tequierobro.jpg](/uploads/2025-02-03-vps-5/tequierobro.jpg)

¬°Te deseo un feliz hosting! ~Pollito <üê§/>